<!-- BANNER SECTION -->
<app-banner-section title="Market" gradientText="Insights"
  subtitle="Comprehensive market intelligence and actionable insights to empower your investment strategy."
  badge="Updated Live" badgeIcon="show_chart" [features]="bannerFeatures" [visualCards]="bannerCards"
  illustration="/assets/images/market_insights.svg">
</app-banner-section>

<!-- DISCLAIMER BANNER -->
<div class="disclaimer-banner">
  <div class="disclaimer-container">
    <div class="disclaimer-icon-wrapper">
      <mat-icon class="disclaimer-icon">info</mat-icon>
    </div>
    <div class="disclaimer-content">
      <h3 class="disclaimer-title">Market Data Disclaimer</h3>
      <p class="disclaimer-text">
        <strong>All market data displayed on this page is sourced from external third-party providers.</strong> 
        While we strive to provide accurate and timely information, we do not independently verify this data. 
        Market prices, indices, and statistics may be subject to delays, inaccuracies, or interruptions. 
        This information is for informational purposes only and does not constitute investment advice. 
        <a routerLink="/privacy-policy" class="disclaimer-link">View full disclaimer</a>
      </p>
    </div>
    @if (showDisclaimer()) {
    <button mat-icon-button class="disclaimer-close" (click)="dismissDisclaimer()" 
            aria-label="Dismiss disclaimer">
      <mat-icon>close</mat-icon>
    </button>
    }
  </div>
</div>

<!-- SUBTLE WARNING MESSAGE -->
@if (hasPartialError()) {
<div class="subtle-warning">
  <mat-icon>info</mat-icon>
  <span>Some data may be inaccurate as our servers are experiencing issues. We're working to resolve this.</span>
</div>
}

<!-- LAST UPDATED INDICATOR -->
<div class="last-updated-wrapper">
  <div class="last-updated-badge" role="status" aria-live="polite" aria-label="Market data last updated">
    <mat-icon class="pulse-icon" aria-hidden="true">update</mat-icon>
    <span class="update-label">Last Updated:</span>
    <span class="update-time">{{ lastUpdated() }}</span>
    <div class="live-indicator" aria-label="Live market data">
      <span class="live-dot" aria-hidden="true"></span>
      <span class="live-text">LIVE</span>
    </div>
  </div>
</div>

<!-- LIVE MARKET INDICES -->
<section class="market-indices">
  <div class="section-container">
    <div class="section-header">
      <h2 class="section-title">ðŸ“ˆ Live Market Indices</h2>
      <p class="section-subtitle">Real-time tracking of major Indian indices</p>
    </div>
    <div class="indices-grid">
      @for (index of majorIndices(); track index.name) {
      <mat-card class="index-card">
        <div class="index-header">
          <div class="index-icon-wrapper" [class.positive]="index.isPositive" [class.negative]="!index.isPositive">
            <mat-icon aria-hidden="true">{{ index.indexIcon || 'show_chart' }}</mat-icon>
          </div>
          <div class="index-info">
            <h3 class="index-name">{{ index.name }}</h3>
            <p class="index-description">{{ index.description }}</p>
          </div>
          <mat-icon class="trend-icon" [class.positive]="index.isPositive" [class.negative]="!index.isPositive" aria-hidden="true">
            {{ index.icon }}
          </mat-icon>
        </div>
        <div class="index-value">{{ index.value || 'N/A' }}</div>
        <div class="index-change" [class.positive]="index.isPositive" [class.negative]="!index.isPositive">
          <span class="change-value">{{ index.change || 'N/A' }}</span>
          <span class="change-percent">({{ index.changePercent || 'N/A' }})</span>
        </div>
        <div class="index-footer">
          <span class="index-timestamp">
            <mat-icon aria-hidden="true">schedule</mat-icon>
            {{ index.timestamp || 'N/A' }}
          </span>
        </div>
      </mat-card>
      }
    </div>
  </div>
</section>

<!-- MARKET MOVERS -->
<section class="market-movers">
  <div class="section-container">
    <div class="movers-grid">
      <div class="movers-section">
        <h3 class="movers-title">
          <mat-icon aria-hidden="true">trending_up</mat-icon>
          ðŸ”¥ Top Gainers
        </h3>
        <div class="movers-list">
          @for (stock of topGainers; track stock.symbol) {
          <div class="mover-item gainer">
            <div class="mover-info">
              <span class="mover-symbol">{{ stock.symbol || 'N/A' }}</span>
              <span class="mover-name">{{ stock.name || 'N/A' }}</span>
            </div>
            <div class="mover-data">
              <span class="mover-price">{{ stock.price ? 'â‚¹' + stock.price : 'N/A' }}</span>
              <span class="mover-change positive">{{ stock.change ? '+' + stock.change + '%' : 'N/A' }}</span>
            </div>
          </div>
          }
        </div>
      </div>

      <div class="movers-section">
        <h3 class="movers-title">
          <mat-icon aria-hidden="true">trending_down</mat-icon>
          ðŸ“‰ Top Losers
        </h3>
        <div class="movers-list">
          @for (stock of topLosers; track stock.symbol) {
          <div class="mover-item loser">
            <div class="mover-info">
              <span class="mover-symbol">{{ stock.symbol || 'N/A' }}</span>
              <span class="mover-name">{{ stock.name || 'N/A' }}</span>
            </div>
            <div class="mover-data">
              <span class="mover-price">{{ stock.price ? 'â‚¹' + stock.price : 'N/A' }}</span>
              <span class="mover-change negative">{{ stock.change ? stock.change + '%' : 'N/A' }}</span>
            </div>
          </div>
          }
        </div>
      </div>

      <div class="movers-section">
        <h3 class="movers-title">
          <mat-icon aria-hidden="true">flash_on</mat-icon>
          âš¡ Most Active
        </h3>
        <div class="movers-list">
          @for (stock of mostActive; track stock.symbol) {
          <div class="mover-item active">
            <div class="mover-info">
              <span class="mover-symbol">{{ stock.symbol || 'N/A' }}</span>
              <span class="mover-name">{{ stock.name || 'N/A' }}</span>
            </div>
            <div class="mover-data">
              <span class="mover-price">{{ stock.price ? 'â‚¹' + stock.price : 'N/A' }}</span>
              <span class="mover-volume">Vol: {{ stock.volume || 'N/A' }}</span>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</section>

<!-- MARKET STATISTICS -->
<section class="market-stats">
  <div class="section-container">
    <div class="section-header">
      <h2 class="section-title">ðŸ“Š Market Overview</h2>
      <p class="section-subtitle">Key statistics and market breadth indicators</p>
    </div>
    <div class="stats-grid">
      @for (stat of marketStats; track stat.label) {
      <mat-card class="stat-card">
        <div class="stat-icon-wrapper" [ngClass]="stat.color">
          <mat-icon aria-hidden="true">{{ stat.icon }}</mat-icon>
        </div>
        <div class="stat-content">
          <div class="stat-label">{{ stat.label }}</div>
          <div class="stat-value">{{ stat.value || 'N/A' }}</div>
          <div class="stat-description">{{ stat.description }}</div>
        </div>
      </mat-card>
      }
    </div>
  </div>
</section>

<!-- SECTORAL PERFORMANCE -->
<section class="sectoral-performance">
  <div class="section-container">
    <div class="section-header">
      <h2 class="section-title">ðŸŽ¯ Sectoral Performance</h2>
      <p class="section-subtitle">How different sectors are performing today</p>
    </div>
    <div class="sectors-grid">
      @for (sector of sectors; track sector.name) {
      <mat-card class="sector-card" [class.positive]="sector.isPositive" [class.negative]="!sector.isPositive">
        <div class="sector-header">
          <div class="sector-icon-wrapper">
            <mat-icon aria-hidden="true">{{ sector.icon }}</mat-icon>
          </div>
          <h3 class="sector-name">{{ sector.name }}</h3>
        </div>
        <div class="sector-change" [class.positive]="sector.isPositive" [class.negative]="!sector.isPositive">
          <mat-icon aria-hidden="true">{{ sector.isPositive ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
          <span>{{ sector.change || 'N/A' }}</span>
        </div>
        <div class="sector-footer">
          <span class="sector-index">{{ sector.index || 'N/A' }}</span>
          <span class="sector-value">{{ sector.value || 'N/A' }}</span>
        </div>
      </mat-card>
      }
    </div>
  </div>
</section>

<!-- CURRENCY & COMMODITIES -->
<section class="currencies-commodities">
  <div class="section-container">
    <div class="cc-grid">
      <div class="cc-section">
        <h3 class="cc-title">
          <mat-icon aria-hidden="true">currency_exchange</mat-icon>
          ðŸ’± Currency Rates
        </h3>
        <div class="cc-list">
          @for (currency of currencies; track currency.pair) {
          <div class="cc-item">
            <div class="cc-icon-wrapper">
              <mat-icon aria-hidden="true">{{ currency.icon || 'currency_exchange' }}</mat-icon>
            </div>
            <div class="cc-info">
              <span class="cc-name">{{ currency.pair || 'N/A' }}</span>
              <span class="cc-description">{{ currency.description || 'N/A' }}</span>
            </div>
            <div class="cc-data">
              <span class="cc-rate">{{ currency.rate || 'N/A' }}</span>
              <span class="cc-change" [class.positive]="currency.isPositive" [class.negative]="!currency.isPositive">
                {{ currency.change || 'N/A' }}
              </span>
            </div>
          </div>
          }
        </div>
      </div>

      <div class="cc-section">
        <h3 class="cc-title">
          <mat-icon>inventory_2</mat-icon>
          ðŸ’Ž Commodities
        </h3>
        <div class="cc-list">
          @for (commodity of commodities; track commodity.name) {
          <div class="cc-item">
            <div class="cc-icon-wrapper">
              <mat-icon aria-hidden="true">{{ commodity.icon || 'inventory_2' }}</mat-icon>
            </div>
            <div class="cc-info">
              <span class="cc-name">{{ commodity.name || 'N/A' }}</span>
              <span class="cc-description">{{ commodity.unit || 'N/A' }}</span>
            </div>
            <div class="cc-data">
              <span class="cc-rate">{{ commodity.price || 'N/A' }}</span>
              <span class="cc-change" [class.positive]="commodity.isPositive" [class.negative]="!commodity.isPositive">
                {{ commodity.change || 'N/A' }}
              </span>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</section>

<!-- MARKET INSIGHTS & ANALYSIS -->
<section class="insights-section">
  <div class="section-container">
    <div class="section-header">
      <h2 class="section-title">ðŸ’¡ Market Analysis & Insights</h2>
      <p class="section-subtitle">Expert perspectives on current market trends</p>
    </div>
    <div class="insights-grid">
      @for (insight of marketInsights; track insight.title) {
      <mat-card class="insight-card">
        <div class="insight-badge" [ngClass]="insight.category">
          <mat-icon>{{ insight.icon }}</mat-icon>
          <span>{{ insight.category }}</span>
        </div>
        <h3 class="insight-title">{{ insight.title }}</h3>
        <p class="insight-content">{{ insight.content }}</p>
        <div class="insight-footer">
          <span class="insight-author">
            <mat-icon>person</mat-icon>
            {{ insight.author }}
          </span>
        </div>
      </mat-card>
      }
    </div>
  </div>
</section>

<!-- CTA SECTION -->
<section class="cta-section">
  <div class="cta-container">
    <div class="cta-content">
      <h2>ðŸš€ Ready to Make Informed Investment Decisions?</h2>
      <p>Use our professional calculators to plan your investments based on current market conditions</p>
      <div class="cta-buttons">
        <button mat-raised-button color="primary" class="cta-button-large" routerLink="/calculators/sip-calculator">
          <mat-icon>trending_up</mat-icon>
          Calculate SIP Returns
        </button>
        <button mat-raised-button class="cta-button-secondary" routerLink="/calculators/tax-calculator">
          <mat-icon>calculate</mat-icon>
          Plan Your Taxes
        </button>
      </div>
    </div>
  </div>
</section>