<div class="loan-calculator-page">
  <!-- BANNER SECTION -->
  <app-banner-section
    title="Home Loan"
    gradientText="EMI Calculator"
    subtitle="Calculate monthly EMI with detailed payment breakdowns."
    badge="Home Loan Planner"
    badgeIcon="home"
    [features]="bannerFeatures"
    [visualCards]="bannerVisualCards"
    illustration="assets/images/Home_Loan_Calculator.jpeg">
  </app-banner-section>

  <!-- Calculator Section -->
  <section class="calculator-section">
    <div class="calculator-container">
      <div class="calculator-grid">
        <!-- Left Side: Input Controls -->
        <mat-card class="input-card">
          <div class="card-header">
            <mat-icon class="header-icon">tune</mat-icon>
            <div>
              <h2 class="card-title">Loan Parameters</h2>
              <p class="card-subtitle">Customize your home loan details</p>
            </div>
          </div>

          <mat-divider></mat-divider>

          <div class="input-controls">
            <!-- Loan Amount -->
            <div class="control-group">
              <label class="control-label">
                <mat-icon aria-hidden="true">currency_rupee</mat-icon>
                Loan Amount
              </label>
              <mat-form-field appearance="outline" class="amount-field">
                <span matPrefix>₹&nbsp;</span>
                <input matInput type="number" [value]="loanAmount()"
                  (input)="onAmountChange($event)" min="100000" max="100000000" />
                <mat-icon matSuffix>home</mat-icon>
                <mat-hint>Min: ₹1L | Max: ₹10Cr</mat-hint>
              </mat-form-field>
              <mat-slider min="100000" max="10000000" step="100000" 
                (input)="onAmountChange($event)" class="custom-slider">
                <input matSliderThumb [value]="loanAmount()"/>
              </mat-slider>
              <div class="slider-labels">
                <span>₹1L</span>
                <span>₹10Cr</span>
              </div>
            </div>

            <!-- Interest Rate -->
            <div class="control-group">
              <label class="control-label">
                <mat-icon aria-hidden="true">percent</mat-icon>
                Interest Rate (per annum)
              </label>
              <div class="value-display">
                <span class="value-number">{{ interestRate() }}</span>
                <span class="value-unit">% p.a.</span>
              </div>
              <mat-slider min="5" max="20" step="0.1" 
                (input)="onRateChange($event)" class="custom-slider">
                <input matSliderThumb [value]="interestRate()"/>
              </mat-slider>
              <div class="slider-labels">
                <span>5%</span>
                <span>20%</span>
              </div>
            </div>

            <!-- Loan Tenure -->
            <div class="control-group">
              <label class="control-label">
                <mat-icon aria-hidden="true">schedule</mat-icon>
                Loan Tenure
              </label>
              <div class="value-display">
                <span class="value-number">{{ loanTenure() }}</span>
                <span class="value-unit">Years</span>
              </div>
              <mat-slider min="1" max="30" step="1"  (input)="onTenureChange($event)"
                class="custom-slider">
                <input matSliderThumb [value]="loanTenure()"/>
              </mat-slider>
              <div class="slider-labels">
                <span>1 Year</span>
                <span>30 Years</span>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button mat-raised-button color="primary" (click)="calculateEMI()" class="calc-button">
                <mat-icon aria-hidden="true">calculate</mat-icon>
                Calculate EMI
              </button>
              <button mat-stroked-button (click)="resetCalculator()" class="reset-button">
                <mat-icon aria-hidden="true">refresh</mat-icon>
                Reset
              </button>
            </div>
          </div>
        </mat-card>

        <!-- Right Side: Results -->
        <div class="results-section">
          <!-- Summary Cards -->
          <div class="summary-cards">
            <mat-card class="summary-card emi">
              <div class="card-icon">
                <mat-icon aria-hidden="true">payments</mat-icon>
              </div>
              <div class="card-content">
                <span class="card-label">Monthly EMI</span>
                <span class="card-value highlight">₹{{ monthlyEMI() | number : "1.0-0" }}</span>
              </div>
            </mat-card>

            <mat-card class="summary-card principal">
              <div class="card-icon">
                <mat-icon aria-hidden="true">account_balance</mat-icon>
              </div>
              <div class="card-content">
                <span class="card-label">Principal Amount</span>
                <span class="card-value">₹{{ loanAmount() | number : "1.0-0" }}</span>
                <span class="card-percentage">{{ principalPercentage() | number : "1.1-1" }}%</span>
              </div>
            </mat-card>

            <mat-card class="summary-card interest">
              <div class="card-icon">
                <mat-icon aria-hidden="true">trending_up</mat-icon>
              </div>
              <div class="card-content">
                <span class="card-label">Total Interest</span>
                <span class="card-value">₹{{ totalInterest() | number : "1.0-0" }}</span>
                <span class="card-percentage">{{ interestPercentage() | number : "1.1-1" }}%</span>
              </div>
            </mat-card>

            <mat-card class="summary-card total">
              <div class="card-icon">
                <mat-icon aria-hidden="true">account_balance_wallet</mat-icon>
              </div>
              <div class="card-content">
                <span class="card-label">Total Payment</span>
                <span class="card-value">₹{{ totalPayment() | number : "1.0-0" }}</span>
              </div>
            </mat-card>
          </div>

          <!-- Charts -->
          <mat-card class="chart-card">
            <h3 class="chart-title">
              <mat-icon aria-hidden="true">pie_chart</mat-icon>
              Loan Breakdown
            </h3>
            <div class="chart-wrapper doughnut-wrapper">
              <canvas baseChart [data]="doughnutChartData" [options]="doughnutChartOptions" type="doughnut">
              </canvas>
            </div>
            <div class="breakdown-summary">
              <div class="summary-item">
                <div class="color-indicator principal-color"></div>
                <div class="summary-details">
                  <span class="summary-label">Principal</span>
                  <span class="summary-value">₹{{ loanAmount() | number : "1.0-0" }}</span>
                </div>
              </div>
              <div class="summary-item">
                <div class="color-indicator interest-color"></div>
                <div class="summary-details">
                  <span class="summary-label">Interest</span>
                  <span class="summary-value">₹{{ totalInterest() | number : "1.0-0" }}</span>
                </div>
              </div>
            </div>
          </mat-card>

          <mat-card class="chart-card">
            <h3 class="chart-title">
              <mat-icon aria-hidden="true">show_chart</mat-icon>
              Loan Amortization
            </h3>
            <div class="chart-wrapper line-wrapper">
              <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" type="line">
              </canvas>
            </div>
          </mat-card>
        </div>
      </div>

      <!-- Yearly Breakdown Table -->
      @if (yearlyBreakdown.length > 0) {
      <mat-card class="breakdown-card">
        <h3 class="breakdown-title">
          <mat-icon aria-hidden="true">table_chart</mat-icon>
          Year-wise Amortization Schedule
        </h3>
        <div class="breakdown-table-wrapper">
          <table class="breakdown-table">
            <thead>
              <tr>
                <th>Year</th>
                <th>Opening Balance</th>
                <th>EMI Paid</th>
                <th>Principal Paid</th>
                <th>Interest Paid</th>
                <th>Closing Balance</th>
              </tr>
            </thead>
            <tbody>
              @for (item of yearlyBreakdown; track item.year) {
              <tr>
                <td class="year-cell">
                  <mat-icon aria-hidden="true">calendar_today</mat-icon>
                  Year {{ item.year }}
                </td>
                <td class="amount-cell">
                  ₹{{ item.openingBalance | number : "1.0-0" }}
                </td>
                <td class="emi-cell">₹{{ item.emiPaid | number : "1.0-0" }}</td>
                <td class="principal-cell">
                  <span class="principal-badge">₹{{ item.principal | number : "1.0-0" }}</span>
                </td>
                <td class="interest-cell">
                  <span class="interest-badge">₹{{ item.interest | number : "1.0-0" }}</span>
                </td>
                <td class="closing-cell">
                  ₹{{ item.closingBalance | number : "1.0-0" }}
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </mat-card>
      }
    </div>
  </section>

  <!-- Info Section -->
  <section class="info-section">
    <div class="info-container">
      <h2 class="info-title">Understanding Home Loans</h2>
      <div class="info-grid">
        <mat-card class="info-card">
          <mat-icon class="info-icon">calculate</mat-icon>
          <h3>What is EMI?</h3>
          <p>
            EMI (Equated Monthly Installment) is the fixed amount you pay every
            month towards your home loan. It includes both principal and
            interest components.
          </p>
          <mat-chip-set>
            <mat-chip>Fixed Payment</mat-chip>
            <mat-chip>Monthly</mat-chip>
          </mat-chip-set>
        </mat-card>

        <mat-card class="info-card">
          <mat-icon class="info-icon">timeline</mat-icon>
          <h3>Loan Amortization</h3>
          <p>
            Initially, a larger portion of your EMI goes towards interest. Over
            time, the principal component increases while interest decreases.
          </p>
          <mat-chip-set>
            <mat-chip>Reducing Balance</mat-chip>
            <mat-chip>Time-based</mat-chip>
          </mat-chip-set>
        </mat-card>

        <mat-card class="info-card">
          <mat-icon class="info-icon">tips_and_updates</mat-icon>
          <h3>Save on Interest</h3>
          <p>
            Make prepayments when possible, choose shorter tenure if affordable,
            or negotiate for lower interest rates to reduce total interest
            burden.
          </p>
          <mat-chip-set>
            <mat-chip>Prepayment</mat-chip>
            <mat-chip>Smart Planning</mat-chip>
          </mat-chip-set>
        </mat-card>
      </div>
    </div>
  </section>

  <!-- Example Section -->
  <section class="example-section">
    <div class="example-container">
      <div class="example-content">
        <div class="example-badge">
          <mat-icon aria-hidden="true">home</mat-icon>
          <span>Real Example</span>
        </div>
        <h2 class="example-title">Plan Your Dream Home</h2>
        <p class="example-description">
          Let's see how a typical home loan works with realistic parameters.
        </p>
        <div class="example-stats">
          <div class="example-stat">
            <mat-icon aria-hidden="true">currency_rupee</mat-icon>
            <div>
              <span class="stat-label">Loan Amount</span>
              <span class="stat-value">₹50,00,000</span>
            </div>
          </div>
          <div class="example-stat">
            <mat-icon aria-hidden="true">schedule</mat-icon>
            <div>
              <span class="stat-label">Loan Tenure</span>
              <span class="stat-value">20 Years</span>
            </div>
          </div>
          <div class="example-stat">
            <mat-icon aria-hidden="true">percent</mat-icon>
            <div>
              <span class="stat-label">Interest Rate</span>
              <span class="stat-value">8.5% p.a.</span>
            </div>
          </div>
        </div>
        <mat-divider></mat-divider>
        <div class="example-result">
          <div class="result-item">
            <span class="result-label">Monthly EMI</span>
            <span class="result-value emi">₹43,391</span>
          </div>
          <div class="result-item">
            <span class="result-label">Total Interest</span>
            <span class="result-value interest">₹54,13,840</span>
          </div>
          <div class="result-item highlight">
            <span class="result-label">Total Amount Payable</span>
            <span class="result-value large">₹1,04,13,840</span>
          </div>
        </div>
        <p class="example-note">
          <mat-icon aria-hidden="true">info</mat-icon>
          Plan your finances wisely to afford your
          <strong>dream home</strong> comfortably!
        </p>
      </div>
      <div class="example-visual">
        <img src="assets/images/home_loan_illustration.jpg" alt="Dream Home" loading="lazy" />
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="cta-container">
      <mat-icon class="cta-icon">home</mat-icon>
      <h2>Ready to Calculate Your Home Loan?</h2>
      <p>
        Use our calculator to plan your EMI and make your dream home a reality
      </p>
      <button mat-raised-button color="primary" class="cta-button" (click)="calculateEMI()">
        <mat-icon aria-hidden="true">calculate</mat-icon>
        Calculate Now
      </button>
    </div>
  </section>
</div>


